{"type":"operationStart","subtype":"profile","data":{"_id":"iBE3BKmeQnCjvHnn","timestamp":"2025-11-29T04:45:23.719Z","state":"queued","mode":"full","creationDate":"2025-11-29T04:45:23.720Z","modificationDate":"2025-11-29T04:45:23.720Z","shortid":"wBUzWrF","$entitySet":"profiles"},"doDiffs":false,"timestamp":1764391523720,"id":"1hxnz3hezyptm7n","previousOperationId":null,"operationId":"3cjnonn5etsdvw0"}
{"type":"log","level":"info","message":"Render request 88 queued for execution and waiting for available worker","previousOperationId":"3cjnonn5etsdvw0","timestamp":1764391523720,"id":"r035hjjd99697su"}
{"type":"operationStart","subtype":"render","name":"orders-main","previousOperationId":"3cjnonn5etsdvw0","timestamp":1764391523728,"id":"f9itp81bq5stn2a","previousEventId":"1hxnz3hezyptm7n","operationId":"51dwmkrgzegqru7","res":{"content":null,"meta":{"diff":"Index: resMeta\n===================================================================\n--- resMeta\n+++ resMeta\n@@ -1,0 +1,1 @@\n\\ No newline at end of file\n+{}\n\\ No newline at end of file\n"}},"req":{"diff":"Index: req\n===================================================================\n--- req\n+++ req\n@@ -1,0 +1,57 @@\n\\ No newline at end of file\n+{\n+  \"template\": {\n+    \"name\": \"orders-main\",\n+    \"recipe\": \"chrome-pdf\",\n+    \"shortid\": \"HJH11D83ce\",\n+    \"folder\": {\n+      \"shortid\": \"erkLzi\"\n+    },\n+    \"engine\": \"handlebars\",\n+    \"scripts\": [\n+      {\n+        \"name\": \"orders-script\",\n+        \"shortid\": \"BJX1Jw82ce\",\n+        \"folder\": {\n+          \"shortid\": \"erkLzi\"\n+        },\n+        \"_id\": \"aaAZcsY4vNTRyNyZ\",\n+        \"__entitySet\": \"scripts\",\n+        \"__name\": \"orders-script\",\n+        \"content\": \"// server side script fetching remote data and preparing report data source\\nconst https = require('https');\\n\\n// call remote http rest api\\nfunction fetchOrders() {\\n    return new Promise((resolve, reject) => {\\n        https.get('https://services.odata.org/V4/Northwind/Northwind.svc/Orders',\\n        (result) => {\\n            var str = '';\\n            result.on('data', (b) => str += b);\\n            result.on('error', reject);\\n            result.on('end', () => resolve(JSON.parse(str).value));\\n        });\\n    })\\n}\\n\\n// group the data for report\\nasync function prepareDataSource() {\\n    const orders = await fetchOrders()\\n    const ordersByShipCountry = orders.reduce((a, v) => {\\n        a[v.ShipCountry] = a[v.ShipCountry] || []\\n        a[v.ShipCountry].push(v)\\n        return a\\n    }, {})\\n\\n    return Object.keys(ordersByShipCountry).map((country) => {\\n        const ordersInCountry = ordersByShipCountry[country]\\n\\n        const accumulated = {}\\n\\n        ordersInCountry.forEach((o) => {\\n            o.OrderDate = new Date(o.OrderDate);\\n            const key = o.OrderDate.getFullYear() + '/' + (o.OrderDate.getMonth() + 1);\\n            accumulated[key] = accumulated[key] || {\\n                value: 0,\\n                orderDate: o.OrderDate\\n            };\\n            accumulated[key].value++;\\n        });\\n\\n        return {\\n            rows: ordersInCountry,\\n            country,\\n            accumulated\\n        }\\n\\n    }).slice(0, 2)\\n}\\n\\n// add jsreport hook which modifies the report input data\\nasync function beforeRender(req, res) {\\n    req.data.orders = await prepareDataSource()\\n}\",\n+        \"creationDate\": \"2025-11-29T01:34:54.920Z\",\n+        \"modificationDate\": \"2025-11-29T01:34:54.920Z\",\n+        \"__isLoaded\": true,\n+        \"__shortid\": \"BJX1Jw82ce\",\n+        \"__folder\": {\n+          \"shortid\": \"erkLzi\"\n+        },\n+        \"scope\": \"template\",\n+        \"isGlobal\": false,\n+        \"__isDirty\": true\n+      }\n+    ],\n+    \"chrome\": {\n+      \"printBackground\": true,\n+      \"marginTop\": \"4cm\",\n+      \"marginRight\": \"1.5cm\",\n+      \"marginBottom\": \"1.5cm\",\n+      \"marginLeft\": \"1.5cm\",\n+      \"waitForJS\": false,\n+      \"headerTemplate\": \"\",\n+      \"footerTemplate\": \"\"\n+    },\n+    \"pdfOperations\": [\n+      {\n+        \"type\": \"merge\",\n+        \"templateShortid\": \"SJVbqZr9f\",\n+        \"renderForEveryPage\": false,\n+        \"mergeWholeDocument\": true\n+      }\n+    ],\n+    \"content\": \"<!--\\nMore complex example demonstrating advanced features like\\n- using custom server script to fetch remote data\\n- using custom modules in safe sandbox\\n- painting a chart\\n- using global helpers\\n- merging custom dynamic header document\\n\\nNote: This example requires jsreport to be configured with\\n{ \\\"trustUserCode\\\": true } or\\n{ \\\"sandbox\\\": { \\\"allowedModules\\\": [\\\"https\\\"] } }\\n!-->\\n<html>\\n  <head>\\n    <meta content=\\\"text/html; charset=utf-8\\\" http-equiv=\\\"Content-Type\\\">\\n    <link rel=\\\"stylesheet\\\" href=\\\"https://cdnjs.cloudflare.com/ajax/libs/metro/4.1.5/css/metro.min.css\\\">\\n    <script src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js'></script>\\n  </head>\\n  <body>\\n    {{#each orders}}\\n        <!-- add hiden information to the page which is resolved in OrdersHeader template\\n             during the pdf merge. See the docs about pdf utils extension for more details. -->\\n        {{{pdfCreatePagesGroup country}}}\\n        <canvas id='orders{{country}}' style=\\\"margin-bottom:30px\\\"></canvas>\\n        <table class='table striped'>\\n            <thead>\\n                <tr>\\n                    <th>OrderID</th>\\n                    <th>ShipAddress</th>\\n                    <th>ShipCity</th>\\n                    <th>ShipCountry</th>\\n                </tr>\\n            </thead>\\n            <tbody>\\n                {{#each rows}}\\n                <tr>\\n                    <td>{{OrderID}}</td>\\n                    <td>{{ShipAddress}}</td>\\n                    <td>{{ShipCity}}</td>\\n                    <td>{{ShipCountry}}</td>\\n                </tr>\\n                {{/each}}\\n            </tbody>\\n        </table>\\n\\n        <script>\\n            // convert data into js string using function from asset global helpers.js\\n            // this results into something like var data = { \\\"a\\\": \\\"foo\\\" }\\n            // which gets afterwards interpreted in chrome into object\\n            var data = {{{toJS accumulated}}}        \\n\\n            new Chart(orders{{country}}.getContext(\\\"2d\\\"), {\\n                type: 'bar',\\n                data: {\\n                    labels: Object.keys(data),\\n                    datasets: [{\\n                        fillColor: 'blue',\\n                        label: \\\"Orders in time\\\",\\n                        backgroundColor: \\\"rgba(27,161,226,0.2)\\\",\\n                        borderColor: \\\"rgba(27,161,226,1)\\\",\\n                        borderWidth: 1,\\n                        hoverBackgroundColor: \\\"rgba(27,161,226,0.4)\\\",\\n                        hoverBorderColor: \\\"rgba(27,161,226,1)\\\",\\n                        data: Object.keys(data).map(function (o) {\\n                            return data[o].value;\\n                        })\\n                    }]\\n                },\\n                options: {\\n                    animation: {\\n                        duration: 0\\n                    }\\n                }\\n            });\\n        </script>\\n        <div style='page-break-after: always;'>\\n        </div>\\n    {{/each}}\\n  </body>\\n</html>\\n\",\n+    \"helpers\": \"\",\n+    \"creationDate\": \"2025-11-29T01:34:54.860Z\",\n+    \"modificationDate\": \"2025-11-29T01:34:54.860Z\"\n+  },\n+  \"data\": {}\n+}\n\\ No newline at end of file\n"}}
{"type":"log","timestamp":1764391523729,"level":"info","message":"Starting rendering request 88","meta":{"rootId":"rgqzzii4kzg2fcd","id":"rgqzzii4kzg2fcd"},"id":"3xqiwl5e8qvfhbg","previousOperationId":"51dwmkrgzegqru7"}
{"type":"log","timestamp":1764391523729,"level":"info","message":"Rendering template { name: orders-main, recipe: chrome-pdf, engine: handlebars, preview: true }","meta":{"rootId":"rgqzzii4kzg2fcd","id":"rgqzzii4kzg2fcd"},"id":"zx712ihhkay2jc7","previousOperationId":"51dwmkrgzegqru7"}
{"type":"log","timestamp":1764391523730,"level":"debug","message":"Data item not defined for this template.","meta":{"rootId":"rgqzzii4kzg2fcd","id":"rgqzzii4kzg2fcd"},"id":"7g6zn0xzibjmgqv","previousOperationId":"51dwmkrgzegqru7"}
{"type":"log","timestamp":1764391523733,"level":"debug","message":"Executing script orders-script (beforeRender)","meta":{"rootId":"rgqzzii4kzg2fcd","id":"rgqzzii4kzg2fcd"},"id":"tzsh1ahuyevlkwc","previousOperationId":"51dwmkrgzegqru7"}
{"type":"log","timestamp":1764391523768,"level":"warn","message":"Error when processing render request 88\n(because) error when evaluating custom script /samples/Orders/orders-script\nrequire of \"https\" module has been blocked. To be able to require custom modules you need to add to configuration { \"trustUserCode\": true } or enable just specific module using { sandbox: { allowedModules\": [\"https\"] }\n\n(sandbox.js line 2:15)\n\n  1 | // server side script fetching remote data and preparing report data source\n> 2 | const https = require('https');\n    |               ^\n  3 |\n  4 | // call remote http rest api\n  5 | function fetchOrders() {\n\n\nError: require of \"https\" module has been blocked. To be able to require custom modules you need to add to configuration { \"trustUserCode\": true } or enable just specific module using { sandbox: { allowedModules\": [\"https\"] }\n  at sandboxRequire (C:\\Users\\siste\\Documents\\WORKSPACE\\reporte\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\requireSandbox.js:64:19)\n  at Object.require (C:\\Users\\siste\\Documents\\WORKSPACE\\reporte\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:89:30)\n  at eval (sandbox.js:2:15)\n  at async run (C:\\Users\\siste\\Documents\\WORKSPACE\\reporte\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:132:18)\n  at async WorkerReporter.runInSandbox [as _runInSandbox] (C:\\Users\\siste\\Documents\\WORKSPACE\\reporte\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\runInSandbox.js:214:14)\n  at async executeScript (C:\\Users\\siste\\Documents\\WORKSPACE\\reporte\\node_modules\\@jsreport\\jsreport-scripts\\lib\\executeScript.js:129:12)\n  at async Scripts._runScript (C:\\Users\\siste\\Documents\\WORKSPACE\\reporte\\node_modules\\@jsreport\\jsreport-scripts\\lib\\worker.js:140:30)\n  at async Scripts.handleBeforeRender (C:\\Users\\siste\\Documents\\WORKSPACE\\reporte\\node_modules\\@jsreport\\jsreport-scripts\\lib\\worker.js:64:7)\n  at async ListenerCollection.fire (C:\\Users\\siste\\Documents\\WORKSPACE\\reporte\\node_modules\\@jsreport\\jsreport-core\\lib\\shared\\listenerCollection.js:157:21)\n  at async beforeRender (C:\\Users\\siste\\Documents\\WORKSPACE\\reporte\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\render\\render.js:24:5)\n  at async WorkerReporter._render (C:\\Users\\siste\\Documents\\WORKSPACE\\reporte\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\render\\render.js:147:7)\n  at async C:\\Users\\siste\\Documents\\WORKSPACE\\reporte\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\reporter.js:233:24\n  at async processAndResponse (C:\\Users\\siste\\Documents\\WORKSPACE\\reporte\\node_modules\\@jsreport\\advanced-workers\\lib\\workerHandler.js:42:17)","meta":{"rootId":"rgqzzii4kzg2fcd","id":"rgqzzii4kzg2fcd"},"id":"6wpvlm95mg31nms","previousOperationId":"51dwmkrgzegqru7"}
{"type":"log","timestamp":1764391523768,"level":"warn","message":"Rendering request 88 finished with error in 50 ms","meta":{"rootId":"rgqzzii4kzg2fcd","id":"rgqzzii4kzg2fcd"},"id":"r8vklqd2co0kgep","previousOperationId":"51dwmkrgzegqru7"}
{"type":"error","timestamp":1764391523770,"statusCode":400,"weak":true,"decoratedSuffix":"\n\n(sandbox.js line 2:15)\n\n  1 | // server side script fetching remote data and preparing report data source\n> 2 | const https = require('https');\n    |               ^\n  3 |\n  4 | // call remote http rest api\n  5 | function fetchOrders() {\n\n","entity":{"shortid":"BJX1Jw82ce","name":"orders-script","content":"// server side script fetching remote data and preparing report data source\nconst https = require('https');\n\n// call remote http rest api\nfunction fetchOrders() {\n    return new Promise((resolve, reject) => {\n        https.get('https://services.odata.org/V4/Northwind/Northwind.svc/Orders',\n        (result) => {\n            var str = '';\n            result.on('data', (b) => str += b);\n            result.on('error', reject);\n            result.on('end', () => resolve(JSON.parse(str).value));\n        });\n    })\n}\n\n// group the data for report\nasync function prepareDataSource() {\n    const orders = await fetchOrders()\n    const ordersByShipCountry = orders.reduce((a, v) => {\n        a[v.ShipCountry] = a[v.ShipCountry] || []\n        a[v.ShipCountry].push(v)\n        return a\n    }, {})\n\n    return Object.keys(ordersByShipCountry).map((country) => {\n        const ordersInCountry = ordersByShipCountry[country]\n\n        const accumulated = {}\n\n        ordersInCountry.forEach((o) => {\n            o.OrderDate = new Date(o.OrderDate);\n            const key = o.OrderDate.getFullYear() + '/' + (o.OrderDate.getMonth() + 1);\n            accumulated[key] = accumulated[key] || {\n                value: 0,\n                orderDate: o.OrderDate\n            };\n            accumulated[key].value++;\n        });\n\n        return {\n            rows: ordersInCountry,\n            country,\n            accumulated\n        }\n\n    }).slice(0, 2)\n}\n\n// add jsreport hook which modifies the report input data\nasync function beforeRender(req, res) {\n    req.data.orders = await prepareDataSource()\n}"},"property":"content","logged":true,"previousOperationId":"51dwmkrgzegqru7","id":"khvy23esnna3a4u","stack":"Error: require of \"https\" module has been blocked. To be able to require custom modules you need to add to configuration { \"trustUserCode\": true } or enable just specific module using { sandbox: { allowedModules\": [\"https\"] }\n  at sandboxRequire (C:\\Users\\siste\\Documents\\WORKSPACE\\reporte\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\requireSandbox.js:64:19)\n  at Object.require (C:\\Users\\siste\\Documents\\WORKSPACE\\reporte\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:89:30)\n  at eval (sandbox.js:2:15)\n  at async run (C:\\Users\\siste\\Documents\\WORKSPACE\\reporte\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:132:18)\n  at async WorkerReporter.runInSandbox [as _runInSandbox] (C:\\Users\\siste\\Documents\\WORKSPACE\\reporte\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\runInSandbox.js:214:14)\n  at async executeScript (C:\\Users\\siste\\Documents\\WORKSPACE\\reporte\\node_modules\\@jsreport\\jsreport-scripts\\lib\\executeScript.js:129:12)\n  at async Scripts._runScript (C:\\Users\\siste\\Documents\\WORKSPACE\\reporte\\node_modules\\@jsreport\\jsreport-scripts\\lib\\worker.js:140:30)\n  at async Scripts.handleBeforeRender (C:\\Users\\siste\\Documents\\WORKSPACE\\reporte\\node_modules\\@jsreport\\jsreport-scripts\\lib\\worker.js:64:7)\n  at async ListenerCollection.fire (C:\\Users\\siste\\Documents\\WORKSPACE\\reporte\\node_modules\\@jsreport\\jsreport-core\\lib\\shared\\listenerCollection.js:157:21)\n  at async beforeRender (C:\\Users\\siste\\Documents\\WORKSPACE\\reporte\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\render\\render.js:24:5)\n  at async WorkerReporter._render (C:\\Users\\siste\\Documents\\WORKSPACE\\reporte\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\render\\render.js:147:7)\n  at async C:\\Users\\siste\\Documents\\WORKSPACE\\reporte\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\reporter.js:233:24\n  at async processAndResponse (C:\\Users\\siste\\Documents\\WORKSPACE\\reporte\\node_modules\\@jsreport\\advanced-workers\\lib\\workerHandler.js:42:17)","message":"Error when evaluating custom script /samples/Orders/orders-script\nrequire of \"https\" module has been blocked. To be able to require custom modules you need to add to configuration { \"trustUserCode\": true } or enable just specific module using { sandbox: { allowedModules\": [\"https\"] }\n\n(sandbox.js line 2:15)\n\n  1 | // server side script fetching remote data and preparing report data source\n> 2 | const https = require('https');\n    |               ^\n  3 |\n  4 | // call remote http rest api\n  5 | function fetchOrders() {\n\n"}
